# Container for running Jenkins with a local jobs volume
# Run this image via
#   - `docker-compose -f jenkins.yml build jenkins`
#   - `docker-compose -f jenkins.yml run jenkins`
jenkins:
  build: ./jenkins
  container_name: <%= projectName %>_jenkins
  volumes:
    - ./env/jenkins/jobs:/var/jenkins_home/jobs
    - ./env/jenkins/plugins.txt:/usr/share/jenkins/plugins.txt
    # Install the commands to make docker work inside the container
    - /usr/bin/docker:/usr/bin/docker
    - /usr/bin/docker-compose:/usr/bin/docker-compose
    # Mount the docker socket so we can execute from within this container
    - /var/run/docker.sock:/var/run/docker.sock
    # Mount a stable location for the Jenkins workspace
    - /opt/development/<%= projectName %>/jenkins/env/workspace/<%= projectName %>:/opt/development/<%= projectName %>/jenkins/env/workspace/<%= projectName %>
  environment:
    DNSDOCK_NAME: jenkins
    DNSDOCK_IMAGE: <%= projectName %>
    VIRTUAL_HOST: build.<%= projectName %>.ci.p2devcloud.com
    VIRTUAL_PORT: 8080
