# Container for running Jenkins with a local jobs volume
# Run this image via
#   - `docker-compose -f jenkins.yml run jenkins`
jenkins:
  image: phase2/jenkins-docker
  volumes:
    - ./env/jenkins/config.xml:/var/jenkins_home/config.xml
    - ./env/jenkins/jobs:/var/jenkins_home/jobs
    # Install the commands to make docker work inside the container
    - /usr/bin/docker:/usr/bin/docker
    - /usr/bin/docker-compose:/usr/bin/docker-compose
    # Mount the docker socket so we can execute from within this container
    - /var/run/docker.sock:/var/run/docker.sock
    # Mount a stable location for the Jenkins workspace
    - /opt/development/<%= projectName %>/jenkins/env/workspace:/opt/development/<%= projectName %>/jenkins/env/workspace
  environment:
    DEVTOOLS_PRIVATE_KEY:
    DNSDOCK_NAME: jenkins
    DNSDOCK_IMAGE: <%= domain %>
    VIRTUAL_HOST: build.<%= projectName %>.ci.p2devcloud.com
    VIRTUAL_PORT: 8080
